<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Printer Dashboard</title>
    <style>
        body { font-family: sans-serif; margin: 30px; }
        .printer { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        h2 { margin-top: 0; }
        button { margin-top: 10px; padding: 8px 16px; }
    </style>
    <script>
        function updatePrinters() {
            fetch('/data')
                .then(res => res.json())
                .then(printers => {
                    printers.forEach((printer) => {
                        document.getElementById('status-' + printer.serial).textContent = printer.status;
                        document.getElementById('temp-' + printer.serial).textContent = printer.bed_temp + ' Â°C';
                    });
                });
        }

        function activate(serial) {
            console.log("ğŸ§² Activatie aangevraagd voor:", serial);
            fetch('/activate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'serial=' + encodeURIComponent(serial)
            })
            .then(res => res.json())
            .then(data => {
                const msg = document.getElementById('msg-' + serial);
                if (data.result === 'ok') {
                    msg.textContent = 'âœ… Schuif geactiveerd!';
                    msg.style.color = 'green';
                } else if (data.result === 'fail') {
                    msg.textContent = 'âŒ Fout bij activeren schuif.';
                    msg.style.color = 'red';
                } else {
                    msg.textContent = 'ğŸ”’ Alleen printer 1 werkt echt.';
                    msg.style.color = 'orange';
                }
            });
        }

        setInterval(updatePrinters, 3000);
    </script>
</head>
<body>
    <h1>ğŸ–¨ï¸ Printer Dashboard</h1>

    {% for p in printers %}
    <div class="printer">
        <h2>{{ p.name }}</h2>
        <p>Status: <strong id="status-{{ p.serial }}">{{ p.status }}</strong></p>
        <p>Bedtemperatuur: <strong id="temp-{{ p.serial }}">{{ p.bed_temp }} Â°C</strong></p>
        <button onclick="activate('{{ p.serial }}')">ğŸ§² Schuif activeren</button>
        <form method="POST" action="/remove_printer" style="display:inline;">
        <input type="hidden" name="serial" value="{{ p.serial }}">
        <button type="submit" onclick="return confirm('Weet je zeker dat je {{ p.name }} wilt verwijderen?')">ğŸ—‘ï¸ Verwijder</button>
        </form>
        <p id="msg-{{ p.serial }}"></p>
    </div>
    {% endfor %}

    <h2>â• Printer toevoegen</h2>
    <form method="POST" action="/add_printer">
        <label>Naam: <input type="text" name="name" required></label><br>
        <label>IP-adres: <input type="text" name="ip" required></label><br>
        <label>Serienummer: <input type="text" name="serial" required></label><br>
        <label>Access code: <input type="text" name="access_code" required></label><br>
        <label>ESP IP-adres: <input type="text" name="esp_ip" required></label><br>
        <button type="submit">Toevoegen</button>
    </form>
</body>
</html>
